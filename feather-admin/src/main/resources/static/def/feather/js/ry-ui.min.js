(function($){$.extend({_tree:{},btTable:{},bttTable:{},table:{_option:{},init:function(options){var defaults={id:"bootstrap-table",type:0,height:undefined,sidePagination:"server",sortName:"",sortOrder:"asc",pagination:true,pageSize:10,pageList:[10,25,50],toolbar:"toolbar",striped:false,escape:false,firstLoad:true,showFooter:false,search:false,showSearch:true,showPageGo:false,showRefresh:true,showColumns:true,showToggle:true,showExport:false,clickToSelect:false,rememberSelected:false,fixedColumns:false,fixedNumber:0,rightFixedColumns:false,rightFixedNumber:0,queryParams:$.table.queryParams,rowStyle:{},otherOpts:{}};var options=$.extend(defaults,options);$.table._option=options;$.btTable=$("#"+options.id);$.table.initEvent();$("#"+options.id).bootstrapTable({url:options.url,contentType:"application/x-www-form-urlencoded",method:"post",cache:false,height:options.height,striped:options.striped,sortable:true,sortStable:true,sortName:options.sortName,sortOrder:options.sortOrder,pagination:options.pagination,pageNumber:1,pageSize:options.pageSize,pageList:options.pageList,firstLoad:options.firstLoad,escape:options.escape,showFooter:options.showFooter,iconSize:"outline",toolbar:"#"+options.toolbar,sidePagination:options.sidePagination,search:options.search,searchText:options.searchText,showSearch:options.showSearch,showPageGo:options.showPageGo,showRefresh:options.showRefresh,showColumns:options.showColumns,showToggle:options.showToggle,showExport:options.showExport,uniqueId:options.uniqueId,clickToSelect:options.clickToSelect,detailView:options.detailView,onClickRow:options.onClickRow,onDblClickRow:options.onDblClickRow,onClickCell:options.onClickCell,onDblClickCell:options.onDblClickCell,rememberSelected:options.rememberSelected,fixedColumns:options.fixedColumns,fixedNumber:options.fixedNumber,rightFixedColumns:options.rightFixedColumns,rightFixedNumber:options.rightFixedNumber,onReorderRow:options.onReorderRow,queryParams:options.queryParams,rowStyle:options.rowStyle,columns:options.columns,responseHandler:$.table.responseHandler,onLoadSuccess:$.table.onLoadSuccess,exportOptions:options.exportOptions,detailFormatter:options.detailFormatter,onCheck:options.onCheck})},queryParams:function(params){var curParams={pageSize:params.limit,pageNum:params.offset/params.limit+1,searchValue:params.search,orderByColumn:params.sort,isAsc:params.order};var currentId=$.common.isEmpty($.table._option.formId)?$("form").attr("id"):$.table._option.formId;return $.extend(curParams,$.common.formToJSON(currentId))},responseHandler:function(res){if(typeof $.table._option.responseHandler=="function"){$.table._option.responseHandler(res)}if(res.code==0){if($.common.isNotEmpty($.table._option.sidePagination)&&$.table._option.sidePagination=="client"){return res.rows}else{if($.common.isNotEmpty($.table._option.rememberSelected)&&$.table._option.rememberSelected){var column=$.common.isEmpty($.table._option.uniqueId)?$.table._option.columns[1].field:$.table._option.uniqueId;$.each(res.rows,function(i,row){row.state=$.inArray(row[column],selectionIds)!==-1})}return{rows:res.rows,total:res.total}}}else{$.modal.alertWarning(res.msg);return{rows:[],total:0}}},initEvent:function(data){$.btTable.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table load-success.bs.table",function(){var rows=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);$("#"+$.table._option.toolbar+" .multiple").toggleClass("disabled",!rows.length);$("#"+$.table._option.toolbar+" .single").toggleClass("disabled",rows.length!=1)});$.btTable.on("check.bs.table check-all.bs.table uncheck.bs.table uncheck-all.bs.table",function(e,rows){var rowIds=$.table.affectedRowIds(rows);if($.common.isNotEmpty($.table._option.rememberSelected)&&$.table._option.rememberSelected){func=$.inArray(e.type,["check","check-all"])>-1?"union":"difference";selectionIds=_[func](selectionIds,rowIds)}});$.btTable.on("click",".img-circle",function(){var src=$(this).attr("src");var target=$(this).data("target");var height=$(this).data("height");var width=$(this).data("width");if($.common.equals("self",target)){layer.open({title:false,type:1,closeBtn:true,shadeClose:true,area:["auto","auto"],content:"<img src='"+src+"' height='"+height+"' width='"+width+"'/>"})}else{if($.common.equals("blank",target)){window.open(src)}}});$.btTable.on("click",".tooltip-show",function(){var input=$(this).prev();input.select();document.execCommand("copy")})},onLoadSuccess:function(data){if(typeof $.table._option.onLoadSuccess=="function"){$.table._option.onLoadSuccess(data)}$("[data-toggle='tooltip']").tooltip()},destroy:function(tableId){var currentId=$.common.isEmpty(tableId)?$.table._option.id:tableId;$("#"+currentId).bootstrapTable("destroy")},serialNumber:function(index){var table=$.btTable.bootstrapTable("getOptions");var pageSize=table.pageSize;var pageNumber=table.pageNumber;return pageSize*(pageNumber-1)+index+1},tooltip:function(value,length){var _length=$.common.isEmpty(length)?20:length;var _text="";var _value=$.common.nullToStr(value);if(_value.length>_length){_text=_value.substr(0,_length)+"...";_value=_value.replace(/\'/g,"’");var actions=[];actions.push($.common.sprintf('<input id="tooltip-show" style="opacity: 0;position: absolute;z-index:-1" type="text" value="%s"/>',_value));actions.push($.common.sprintf("<a href='###' class='tooltip-show' data-toggle='tooltip' title='%s'>%s</a>",_value,_text));return actions.join("")}else{_text=_value;return _text}},dropdownToggle:function(value){var actions=[];actions.push('<div class="btn-group">');actions.push('<button type="button" class="btn btn-xs dropdown-toggle" data-toggle="dropdown" aria-expanded="false">');actions.push('<i class="fa fa-cog"></i>&nbsp;<span class="fa fa-chevron-down"></span></button>');actions.push('<ul class="dropdown-menu">');actions.push(value.replace(/<a/g,"<li><a").replace(/<\/a>/g,"</a></li>"));actions.push("</ul>");actions.push("</div>");return actions.join("")},imageView:function(_option){if($.common.isEmpty(_option.className)){_option.className=""}if($.common.isEmpty(_option.style)){_option.style=""}if($.common.isEmpty(_option.target)){_option.target="self"}if($.common.isNotEmpty(_option.url)){return $.common.sprintf("<img class='img-circle img-xs %s' style='%s' data-target='%s' src='%s'/>",_option.className,_option.style,_option.target,_option.url)}else{return $.common.nullToStr(null)}},search:function(formId,data){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var params=$.btTable.bootstrapTable("getOptions");params.queryParams=function(params){var search=$.common.formToJSON(currentId);if($.common.isNotEmpty(data)){$.each(data,function(key){search[key]=data[key]})}search.pageSize=params.limit;search.pageNum=params.offset/params.limit+1;search.searchValue=params.search;search.orderByColumn=params.sort;search.isAsc=params.order;return search};$.btTable.bootstrapTable("refresh",params)},exportExcel:function(formId){$.modal.confirm("确定导出所有"+$.table._option.modalName+"吗？",function(){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;$.modal.loading("正在导出数据，请稍后...");$.post($.table._option.exportUrl,$("#"+currentId).serializeArray(),function(result){if(result.code==web_status.SUCCESS){window.location.href=ctx+"system/common/download?fileName="+encodeURI(result.msg)+"&delete="+true}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}$.modal.closeLoading()})})},importTemplate:function(){if($.table._option.importTemplate){window.location.href=$.table._option.importTemplate}else{$.get($.table._option.importTemplateUrl,function(result){if(result.code==web_status.SUCCESS){window.location.href=ctx+"system/common/download?fileName="+encodeURI(result.msg)+"&delete="+true}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}})}},importExcel:function(formId){var currentId=$.common.isEmpty(formId)?"importTpl":formId;layer.open({type:1,area:["400px","230px"],fix:false,maxmin:true,shade:0.3,title:"导入"+$.table._option.modalName+"数据",content:$("#"+currentId).html(),btn:['<i class="fa fa-check"></i> 导入','<i class="fa fa-remove"></i> 取消'],shadeClose:true,btn1:function(index,layero){var file=layero.find("#file").val();if(file==""||(!$.common.endWith(file,".xls")&&!$.common.endWith(file,".xlsx"))){$.modal.msgWarning("请选择后缀为 “xls”或“xlsx”的文件。");return false}var index=layer.load(2,{shade:false});$.modal.disable();var formData=new FormData();formData.append("file",$("#file")[0].files[0]);formData.append("updateSupport",$("input[name='updateSupport']").is(":checked"));$.ajax({url:$.table._option.importUrl,data:formData,cache:false,contentType:false,processData:false,type:"POST",success:function(result){if(result.code==web_status.SUCCESS){$.modal.closeAll();$.modal.alertSuccess(result.msg);$.table.refresh()}else{if(result.code==web_status.WARNING){layer.close(index);$.modal.enable();$.modal.alertWarning(result.msg)}else{layer.close(index);$.modal.enable();$.modal.alertError(result.msg)}}}})}})},refresh:function(){$.btTable.bootstrapTable("refresh",{silent:true})},selectColumns:function(column){var rows=$.map($.btTable.bootstrapTable("getSelections"),function(row){return row[column]});if($.common.isNotEmpty($.table._option.rememberSelected)&&$.table._option.rememberSelected){rows=rows.concat(selectionIds)}return $.common.uniqueFn(rows)},affectedRowIds:function(rows){var column=$.common.isEmpty($.table._option.uniqueId)?$.table._option.columns[1].field:$.table._option.uniqueId;var rowIds;if($.isArray(rows)){rowIds=$.map(rows,function(row){return row[column]})}else{rowIds=[rows[column]]}return rowIds},selectFirstColumns:function(){var rows=$.map($.btTable.bootstrapTable("getSelections"),function(row){return row[$.table._option.columns[1].field]});if($.common.isNotEmpty($.table._option.rememberSelected)&&$.table._option.rememberSelected){rows=rows.concat(selectionIds)}return $.common.uniqueFn(rows)},selectDictLabel:function(datas,value){var actions=[];$.each(datas,function(index,dict){if(dict.dictValue==(""+value)){var listClass=$.common.equals("default",dict.listClass)||$.common.isEmpty(dict.listClass)?"":"badge badge-"+dict.listClass;if(listClass==""&&datas.length==2&&((datas[0].dictValue==0&&datas[1].dictValue==1)||(datas[0].dictValue==1&&datas[1].dictValue==0))){if(dict.dictValue==1){listClass="badge badge-primary"}else{if(dict.dictValue==0){listClass="badge badge-danger"}}}actions.push($.common.sprintf("<span class='%s'>%s</span>",listClass,dict.dictLabel));return false}});return actions.join("")},showColumn:function(column){$.btTable.bootstrapTable("showColumn",column)},hideColumn:function(column){$.btTable.bootstrapTable("hideColumn",column)}},treeTable:{init:function(options){var defaults={id:options.eleId||"bootstrap-tree-table",type:1,height:0,rootIdValue:null,ajaxParams:{},toolbar:"toolbar",striped:false,expandColumn:1,showSearch:true,showRefresh:true,showColumns:true,expandAll:true,expandFirst:true};var options=$.extend(defaults,options);$.table._option=options;$.bttTable=$("#"+options.id).bootstrapTreeTable({code:options.code,parentCode:options.parentCode,type:"post",url:options.url,data:options.data,ajaxParams:options.ajaxParams,rootIdValue:options.rootIdValue,height:options.height,expandColumn:options.expandColumn,striped:options.striped,bordered:true,toolbar:"#"+options.toolbar,showSearch:options.showSearch,showRefresh:options.showRefresh,showColumns:options.showColumns,expandAll:options.expandAll,expandFirst:options.expandFirst,columns:options.columns,responseHandler:$.treeTable.responseHandler})},search:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var params=$.common.formToJSON(currentId);$.bttTable.bootstrapTreeTable("refresh",params)},refresh:function(){$.bttTable.bootstrapTreeTable("refresh")},selectColumns:function(column){var rows=$.map($.bttTable.bootstrapTreeTable("getSelections"),function(row){return row[column]});return $.common.uniqueFn(rows)},responseHandler:function(data){if(data.code!=undefined&&data.code!=0){$.modal.alertWarning(data.msg);return[]}else{return data}},},form:{reset:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;$("#"+currentId)[0].reset();if($.table._option.type==table_type.bootstrapTable){$.btTable.bootstrapTable("refresh")}},selectCheckeds:function(name){var checkeds="";$('input:checkbox[name="'+name+'"]:checked').each(function(i){if(0==i){checkeds=$(this).val()}else{checkeds+=(","+$(this).val())}});return checkeds},selectSelects:function(name){var selects="";$("#"+name+" option:selected").each(function(i){if(0==i){selects=$(this).val()}else{selects+=(","+$(this).val())}});return selects}},modal:{icon:function(type){var icon="";if(type==modal_status.WARNING){icon=0}else{if(type==modal_status.SUCCESS){icon=1}else{if(type==modal_status.FAIL){icon=2}else{icon=3}}}return icon},msg:function(content,type){if(type!=undefined){layer.msg(content,{icon:$.modal.icon(type),time:1000,shift:5})}else{layer.msg(content)}},msgError:function(content){$.modal.msg(content,modal_status.FAIL)},msgSuccess:function(content){$.modal.msg(content,modal_status.SUCCESS)},msgWarning:function(content){$.modal.msg(content,modal_status.WARNING)},alert:function(content,type){layer.alert(content,{icon:$.modal.icon(type),title:"系统提示",btn:["确认"],btnclass:["btn btn-primary"],})},msgReload:function(msg,type){layer.msg(msg,{icon:$.modal.icon(type),time:500,shade:[0.1,"#8F8F8F"]},function(){$.modal.reload()})},alertError:function(content){$.modal.alert(content,modal_status.FAIL)},alertSuccess:function(content){$.modal.alert(content,modal_status.SUCCESS)},alertWarning:function(content){$.modal.alert(content,modal_status.WARNING)},close:function(){var index=parent.layer.getFrameIndex(window.name);parent.layer.close(index)},closeAll:function(){layer.closeAll()},confirm:function(content,callBack){layer.confirm(content,{icon:3,title:"系统提示",btn:["确认","取消"]},function(index){layer.close(index);callBack(true)})},open:function(title,url,width,height,callback){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if($.common.isEmpty(title)){title=false}if($.common.isEmpty(url)){url="/404.html"}if($.common.isEmpty(width)){width=800}if($.common.isEmpty(height)){height=($(window).height()-50)}if($.common.isEmpty(callback)){callback=function(index,layero){var iframeWin=layero.find("iframe")[0];iframeWin.contentWindow.submitHandler(index,layero)}}layer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url,btn:["确定","关闭"],shadeClose:true,yes:callback,cancel:function(index){return true}})},openOptions:function(options){var _url=$.common.isEmpty(options.url)?"/404.html":options.url;var _title=$.common.isEmpty(options.title)?"系统窗口":options.title;var _width=$.common.isEmpty(options.width)?"800":options.width;var _height=$.common.isEmpty(options.height)?($(window).height()-50):options.height;var _btn=['<i class="fa fa-check"></i> 确认','<i class="fa fa-close"></i> 关闭'];if($.common.isEmpty(options.yes)){options.yes=function(index,layero){options.callBack(index,layero)}}layer.open({type:2,maxmin:true,shade:0.3,title:_title,fix:false,area:[_width+"px",_height+"px"],content:_url,shadeClose:$.common.isEmpty(options.shadeClose)?true:options.shadeClose,skin:options.skin,btn:$.common.isEmpty(options.btn)?_btn:options.btn,yes:options.yes,cancel:function(){return true}})},openFull:function(title,url,width,height){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if($.common.isEmpty(title)){title=false}if($.common.isEmpty(url)){url="/404.html"}if($.common.isEmpty(width)){width=800}if($.common.isEmpty(height)){height=($(window).height()-50)}var index=layer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url,btn:["确定","关闭"],shadeClose:true,yes:function(index,layero){var iframeWin=layero.find("iframe")[0];iframeWin.contentWindow.submitHandler(index,layero)},cancel:function(index){return true}});layer.full(index)},openTab:function(title,url){createMenuItem(url,title)},parentTab:function(title,url){var dataId=window.frameElement.getAttribute("data-id");createMenuItem(url,title);closeItem(dataId)},closeTab:function(dataId){closeItem(dataId)},disable:function(){var doc=window.top==window.parent?window.document:window.parent.document;$("a[class*=layui-layer-btn]",doc).addClass("layer-disabled")},enable:function(){var doc=window.top==window.parent?window.document:window.parent.document;$("a[class*=layui-layer-btn]",doc).removeClass("layer-disabled")},loading:function(message){$.blockUI({message:'<div class="loaderbox"><div class="loading-activity"></div> '+message+"</div>"})},closeLoading:function(){setTimeout(function(){$.unblockUI()},50)},reload:function(){parent.location.reload()}},operate:{submit:function(_option){var config={url:_option.url,type:_option.type,dataType:_option.dataType,data:_option.data,beforeSend:function(){$.modal.loading("正在处理中，请稍后...")},success:function(result){if(typeof _option.callback=="function"){_option.callback(result)}$.operate.ajaxSuccess(result,_option)}};if(typeof _option.contentType==="boolean"){config.contentType=_option.contentType}if(typeof _option.processData==="boolean"){config.processData=_option.processData}$.ajax(config)},post:function(url,data,callback){$.operate.submit({url:url,type:"post",dataType:"json",data:data,callback:callback})},get:function(url,callback){$.operate.submit({url:url,type:"get",dataType:"json",data:"",callback:callback})},detail:function(id,width,height,ext){var _url=$.operate.detailUrl(id,ext);var options={title:$.table._option.openTabTitle||($.table._option.modalName+"详细"),width:width,height:height,url:$.operate.detailUrl(id,ext),skin:"layui-layer-gray",btn:["关闭"],yes:function(index,layero){layer.close(index)}};$.modal.openOptions(options)},detailTab:function(id,ext){$.modal.openTab($.table._option.openTabTitle||($.table._option.modalName+"详细"),$.operate.detailUrl(id,ext))},detailUrl:function(id,ext){var url="/404.html";if($.common.isNotEmpty(id)){url=$.table._option.detailUrl.replace("{id}",id)}else{var id=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(id.length==0){$.modal.alertWarning("请至少选择一条记录");return}url=$.table._option.detailUrl.replace("{id}",id)}url=url.replace("{ext}",ext||"");return url},remove:function(id,ext){$.modal.confirm("确定删除该条"+$.table._option.modalName+"信息吗？",function(){var url=$.table._option.removeUrl;if($.common.isNotEmpty(id)){url=url.replace("{id}",id)}url=url.replace("{ext}",ext||"");if($.table._option.type==table_type.bootstrapTreeTable){$.operate.get(url)}else{var data={"ids":id};$.operate.submit({url:url,type:"post",dataType:"json",data:data})}})},removeAll:function(){var rows=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(rows.length==0){$.modal.alertWarning("请至少选择一条记录");return}$.modal.confirm("确认要删除选中的"+rows.length+"条数据吗?",function(){var url=$.table._option.removeUrl;url=url.replace("{ext}","");var data={"ids":rows.join()};$.operate.submit({url:url,type:"post",dataType:"json",data:data})})},clean:function(){$.modal.confirm("确定清空所有"+$.table._option.modalName+"吗？",function(){var url=$.table._option.cleanUrl;$.operate.submit({url:url,type:"post",dataType:"json",data:""})})},add:function(id,ext){$.modal.open($.table._option.openTabTitle||("添加"+$.table._option.modalName),$.operate.addUrl(id,ext))},addTab:function(id,ext){$.modal.openTab($.table._option.openTabTitle||("添加"+$.table._option.modalName),$.operate.addUrl(id,ext))},addFull:function(id,ext){var url=$.table._option.createUrl;if($.common.isNotEmpty(id)){url=url.replace("{id}",id)}url=url.replace("{ext}",ext||"");$.modal.openFull($.table._option.openTabTitle||("添加"+$.table._option.modalName),url)},addUrl:function(id,ext){var url=$.table._option.createUrl;if($.common.isNotEmpty(id)){url=url.replace("{id}",id)}url=url.replace("{ext}",ext||"");return url},edit:function(id,ext){if($.common.isEmpty(id)&&$.table._option.type==table_type.bootstrapTreeTable){var row=$.bttTable.bootstrapTreeTable("getSelections")[0];if($.common.isEmpty(row)){$.modal.alertWarning("请至少选择一条记录");return}var url=$.table._option.updateUrl.replace("{id}",row[$.table._option.uniqueId]);url=url.replace("{ext}",ext||"");$.modal.open($.table._option.openTabTitle||("修改"+$.table._option.modalName),url)}else{$.modal.open($.table._option.openTabTitle||("修改"+$.table._option.modalName),$.operate.editUrl(id,ext))}},editTab:function(id,ext){$.modal.openTab($.table._option.openTabTitle||("修改"+$.table._option.modalName),$.operate.editUrl(id,ext))},editFull:function(id,ext){var url="/404.html";if($.common.isNotEmpty(id)){url=$.table._option.updateUrl.replace("{id}",id)}else{var row=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);url=$.table._option.updateUrl.replace("{id}",row)}url=url.replace("{ext}",ext||"");$.modal.openFull($.table._option.openTabTitle||("修改"+$.table._option.modalName),url)},editUrl:function(id,ext){var url="/404.html";if($.common.isNotEmpty(id)){url=$.table._option.updateUrl.replace("{id}",id)}else{var id=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(id.length==0){$.modal.alertWarning("请至少选择一条记录");return}url=$.table._option.updateUrl.replace("{id}",id)}url=url.replace("{ext}",ext||"");return url},save:function(_option){var config={url:_option.url,type:"post",dataType:"json",data:_option.data,beforeSend:function(){$.modal.loading("正在处理中，请稍后...");$.modal.disable()},success:function(result){if(typeof _option.callback=="function"){_option.callback(result)}$.operate.successCallback(result,_option)}};if(typeof _option.contentType==="boolean"){config.contentType=_option.contentType}if(typeof _option.processData==="boolean"){config.processData=_option.processData}$.ajax(config)},saveModal:function(_option){var config={url:_option.url,type:"post",dataType:"json",data:_option.data,beforeSend:function(){$.modal.loading("正在处理中，请稍后...")},success:function(result){if(typeof _option.callback=="function"){_option.callback(result)}if(result.code==web_status.SUCCESS){$.modal.alertSuccess(result.msg)}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}$.modal.closeLoading()}};if(typeof _option.contentType==="boolean"){config.contentType=_option.contentType}if(typeof _option.processData==="boolean"){config.processData=_option.processData}$.ajax(config)},saveTab:function(_option){_option=_option||{};var config={url:_option.url,type:"post",dataType:"json",data:_option.data,beforeSend:function(){$.modal.loading("正在处理中，请稍后...")},success:function(result){if(typeof _option.callback=="function"){_option.callback(result)}$.operate.successTabCallback(result,_option)}};if(typeof _option.contentType==="boolean"){config.contentType=_option.contentType}if(typeof _option.processData==="boolean"){config.processData=_option.processData}$.ajax(config)},otherOpt:function(id,ext,opt,optName){if($.table._option.type==table_type.bootstrapTreeTable){if($.common.isEmpty(id)){var row=$.bttTable.bootstrapTreeTable("getSelections")[0];if($.common.isEmpty(row)){$.modal.alertWarning("请至少选择一条记录");return}if($.table._option.otherOpts[opt]){var optUrl=$.table._option.otherOpts[opt];var url=optUrl.replace("{id}",row[$.table._option.uniqueId]);url=url.replace("{ext}",ext||"");$.modal.open(optName+$.table._option.modalName,url)}else{$.modal.alertWarning("该操作地址不存在，请联系管理员!")}}else{if($.table._option.otherOpts[opt]){var optUrl=$.table._option.otherOpts[opt];var url=optUrl.replace("{id}",id);url=url.replace("{ext}",ext||"");$.modal.open(optName+$.table._option.modalName,url)}else{$.modal.alertWarning("该操作地址不存在，请联系管理员!")}}}else{if($.table._option.otherOpts[opt]){$.modal.open(optName+$.table._option.modalName,$.operate.otherOptUrl(id,ext,opt))}else{$.modal.alertWarning("该操作地址不存在，请联系管理员!")}}},otherOptUrl:function(id,ext,opt){var url="/404.html";var optUrl=$.table._option.otherOpts[opt];if($.common.isNotEmpty(id)){url=optUrl.replace("{id}",id)}else{var id=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(id.length==0){$.modal.alertWarning("请至少选择一条记录");return}url=optUrl.replace("{id}",id)}url=url.replace("{ext}",ext||"");return url},ajaxSuccess:function(result,_option){if(result.code==web_status.SUCCESS&&$.table._option.type==table_type.bootstrapTable){$.modal.msgSuccess(result.msg);$.table.refresh()}else{if(result.code==web_status.SUCCESS&&$.table._option.type==table_type.bootstrapTreeTable){$.modal.msgSuccess(result.msg);$.treeTable.refresh()}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}}$.modal.closeLoading()},saveSuccess:function(result){if(result.code==web_status.SUCCESS){$.modal.msgReload("保存成功,正在刷新数据请稍后……",modal_status.SUCCESS)}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}$.modal.closeLoading()},successCallback:function(result,_option){if(result.code==web_status.SUCCESS){var parent=window.parent;var successFunc=function(){if(_option&&typeof _option.success=="function"){_option.success(result,_option)}else{if(_option&&_option.success=="close"){$.modal.close();parent.$.modal.msgSuccess(result.msg)}else{setTimeout(function(){parent.$.modal.msgSuccess(result.msg)},80)}}};if(parent.$.table._option.type==table_type.bootstrapTable){successFunc();parent.$.table.refresh()}else{if(parent.$.table._option.type==table_type.bootstrapTreeTable){successFunc();parent.$.treeTable.refresh()}else{$.modal.msgReload("保存成功,正在刷新数据请稍后……",modal_status.SUCCESS)}}}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}$.modal.closeLoading();$.modal.enable()},successTabCallback:function(result,_option){if(result.code==web_status.SUCCESS){var topWindow=$(window.parent.document);var currentId=$(".page-tabs-content",topWindow).find(".active").attr("data-panel");var $contentWindow=$('.Feather_iframe[data-id="'+currentId+'"]',topWindow)[0].contentWindow;$.modal.close();$contentWindow.$(".layui-layer-padding").removeAttr("style");if($contentWindow.$.table._option.type==table_type.bootstrapTable){$contentWindow.$.table.refresh()}else{if($contentWindow.$.table._option.type==table_type.bootstrapTreeTable){$contentWindow.$.treeTable.refresh()}}if(_option&&typeof _option.success=="function"){_option.success(result,_option)}else{if(_option&&_option.success=="close"){$.modal.closeTab();$contentWindow.$.modal.msgSuccess(result.msg)}else{setTimeout(function(){$.modal.msgSuccess(result.msg)},80)}}}else{if(result.code==web_status.WARNING){$.modal.alertWarning(result.msg)}else{$.modal.alertError(result.msg)}}$.modal.closeLoading()}},validate:{form:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;return $("#"+currentId).validate().form()}},tree:{_option:{},_lastValue:{},init:function(options){var defaults={id:options.eleId||"tree",expandLevel:0,view:{selectedMulti:false,nameIsHTML:true},check:{enable:false,nocheckInherit:true,},data:{key:{title:"title"},simpleData:{enable:true}},};var options=$.extend(defaults,options);$.tree._option=options;var setting={callback:{onClick:options.onClick,onCheck:options.onCheck,onDblClick:options.onDblClick,onDrop:options.onDrop,},check:options.check,view:options.view,data:options.data,edit:{enable:true,showRemoveBtn:false,showRenameBtn:false,drag:{isCopy:false,isMove:true,prev:true,next:true,inner:true}},};$.get(options.url,function(data){var treeId=$("#treeId").val();tree=$.fn.zTree.init($("#"+options.id),setting,data);$._tree=tree;var nodes=tree.getNodesByParam("level",options.expandLevel-1);for(var i=0;i<nodes.length;i++){tree.expandNode(nodes[i],true,false,false)}var node=tree.getNodesByParam("id",treeId,null)[0];$.tree.selectByIdName(treeId,node)})},searchNode:function(){var value=$.common.trim($("#keyword").val());if($.tree._lastValue==value){return}$.tree._lastValue=value;var nodes=$._tree.getNodes();if(value==""){$.tree.showAllNode(nodes);return}$.tree.hideAllNode(nodes);$.tree.updateNodes($._tree.getNodesByParamFuzzy("name",value))},selectByIdName:function(treeId,node){if($.common.isNotEmpty(treeId)&&treeId==node.id){$._tree.selectNode(node,true)}},showAllNode:function(nodes){nodes=$._tree.transformToArray(nodes);for(var i=nodes.length-1;i>=0;i--){if(nodes[i].getParentNode()!=null){$._tree.expandNode(nodes[i],true,false,false,false)}else{$._tree.expandNode(nodes[i],true,true,false,false)}$._tree.showNode(nodes[i]);$.tree.showAllNode(nodes[i].children)}},hideAllNode:function(nodes){var tree=$.fn.zTree.getZTreeObj("tree");var nodes=$._tree.transformToArray(nodes);for(var i=nodes.length-1;i>=0;i--){$._tree.hideNode(nodes[i])}},showParent:function(treeNode){var parentNode;while((parentNode=treeNode.getParentNode())!=null){$._tree.showNode(parentNode);$._tree.expandNode(parentNode,true,false,false);treeNode=parentNode}},showChildren:function(treeNode){if(treeNode.isParent){for(var idx in treeNode.children){var node=treeNode.children[idx];$._tree.showNode(node);$.tree.showChildren(node)}}},updateNodes:function(nodeList){$._tree.showNodes(nodeList);for(var i=0,l=nodeList.length;i<l;i++){var treeNode=nodeList[i];$.tree.showChildren(treeNode);$.tree.showParent(treeNode)}},getCheckedNodes:function(column){var _column=$.common.isEmpty(column)?"id":column;var nodes=$._tree.getCheckedNodes(true);return $.map(nodes,function(row){return row[_column]}).join()},notAllowParents:function(_tree){var nodes=_tree.getSelectedNodes();if(nodes.length==0){$.modal.msgError("请选择节点后提交");return false}for(var i=0;i<nodes.length;i++){if(nodes[i].level==0){$.modal.msgError("不能选择根节点（"+nodes[i].name+"）");return false}if(nodes[i].isParent){$.modal.msgError("不能选择父节点（"+nodes[i].name+"）");return false}}return true},notAllowLastLevel:function(_tree){var nodes=_tree.getSelectedNodes();for(var i=0;i<nodes.length;i++){if(!nodes[i].isParent){$.modal.msgError("不能选择最后层级节点（"+nodes[i].name+"）");return false}}return true},toggleSearch:function(){$("#search").slideToggle(200);$("#btnShow").toggle();$("#btnHide").toggle();$("#keyword").focus()},collapse:function(){$._tree.expandAll(false)},expand:function(){$._tree.expandAll(true)}},common:{isEmpty:function(value){if(value==null||this.trim(value)==""){return true}return false},isNotEmpty:function(value){return !$.common.isEmpty(value)},nullToStr:function(value){if($.common.isEmpty(value)){return"-"}return value},visible:function(value){if($.common.isEmpty(value)||value==true){return true}return false},trim:function(value){if(value==null){return""}return value.toString().replace(/(^\s*)|(\s*$)|\r|\n/g,"")},equals:function(str,that){return str==that},equalsIgnoreCase:function(str,that){return String(str).toUpperCase()===String(that).toUpperCase()},split:function(str,sep,maxLen){if($.common.isEmpty(str)){return null}var value=String(str).split(sep);return maxLen?value.slice(0,maxLen-1):value},sprintf:function(str){var args=arguments,flag=true,i=1;str=str.replace(/%s/g,function(){var arg=args[i++];if(typeof arg==="undefined"){flag=false;return""}if(arg==null){flag=true;return""}return arg});return flag?str:""},random:function(min,max){return Math.floor((Math.random()*max)+min)},startWith:function(value,start){var reg=new RegExp("^"+start);return reg.test(value)},endWith:function(value,end){var reg=new RegExp(end+"$");return reg.test(value)},uniqueFn:function(array){var result=[];var hashObj={};for(var i=0;i<array.length;i++){if(!hashObj[array[i]]){hashObj[array[i]]=true;result.push(array[i])}}return result},findRepeat:function(array,ret){for(var i=0;i<array.length;i++){if(array[i]==""||array[i]==null){continue}if(array.indexOf(array[i])!=i){if(ret=="val"){return array[i]}if(ret=="index"){return i}return true}}return null},join:function(array,separator){if($.common.isEmpty(array)){return null}return array.join(separator)},formToJSON:function(formId){var json={};$.each($("#"+formId).serializeArray(),function(i,field){json[field.name]=field.value});return json},delHtmlTag:function(str){if($.common.isNotEmpty(str)){return str.replace(/<[^>]+>/g,"")}return str},getBasePath:function(){var base=window.location.protocol+"//"+window.location.host;return base}}})})(jQuery);table_type={bootstrapTable:0,bootstrapTreeTable:1};web_status={SUCCESS:0,FAIL:500,WARNING:301};modal_status={SUCCESS:"success",FAIL:"error",WARNING:"warning"};